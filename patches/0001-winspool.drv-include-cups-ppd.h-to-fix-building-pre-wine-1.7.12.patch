From 2ac0c877f591be14815902b527f314a915eee147 Mon Sep 17 00:00:00 2001
From: Ken Thomases <ken@codeweavers.com>
Date: Mon, 27 Jun 2016 15:34:07 -0500
Subject: [PATCH] winspool.drv: Include <cups/ppd.h> to fix building against
 the macOS 10.12 SDK.

The cupsGetPPD() function was moved there from <cups/cups.h> because it's
deprecated.

Signed-off-by: Ken Thomases <ken@codeweavers.com>
Signed-off-by: Huw Davies <huw@codeweavers.com>
Signed-off-by: Alexandre Julliard <julliard@winehq.org>

[robert.michelsen@gmx.net: Manual configure.ac fixup needed for:
https://source.winehq.org/git/wine.git/commitdiff/cf0e96c6d0edc3a22b8ee5ac423d9b6b652ce0e5
]

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=40851
---
 configure                | 12 ++++++++++++
 configure.ac             |  3 ++-
 dlls/winspool.drv/info.c |  3 +++
 include/config.h.in      |  3 +++
 4 files changed, 20 insertions(+), 1 deletion(-)

diff --git a/configure b/configure
index c2d0dd087e2..97019c772ab 100755
--- a/configure
+++ b/configure
@@ -12447,6 +12447,18 @@ _ACEOF
 
        CUPSINCL="$ac_cups_cflags"
 fi
+             for ac_header in cups/ppd.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "cups/ppd.h" "ac_cv_header_cups_ppd_h" "$ac_includes_default"
+if test "x$ac_cv_header_cups_ppd_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_CUPS_PPD_H 1
+_ACEOF
+
+fi
+
+done
+
 fi
 
 done
diff --git a/configure.ac b/configure.ac
index 4f51909fade..eee9f5887a9 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1609,7 +1609,8 @@ then
     AC_CHECK_HEADERS(cups/cups.h,
             [WINE_CHECK_SONAME(cups,cupsGetDefault,
                        [CUPSINCL="$ac_cups_cflags"],,
-                       [$ac_cups_libs])])
+                       [$ac_cups_libs])
+             AC_CHECK_HEADERS(cups/ppd.h)])
     CPPFLAGS="$ac_save_CPPFLAGS"
 fi
 WINE_NOTICE_WITH(cups,[test "x$ac_cv_lib_soname_cups" = "x"],
diff --git a/dlls/winspool.drv/info.c b/dlls/winspool.drv/info.c
index 8ddebb4bc0e..d3f20d7d6c0 100644
--- a/dlls/winspool.drv/info.c
+++ b/dlls/winspool.drv/info.c
@@ -44,6 +44,9 @@
 #ifdef HAVE_CUPS_CUPS_H
 # include <cups/cups.h>
 #endif
+#ifdef HAVE_CUPS_PPD_H
+# include <cups/ppd.h>
+#endif
 
 #ifdef HAVE_APPLICATIONSERVICES_APPLICATIONSERVICES_H
 #define GetCurrentProcess GetCurrentProcess_Mac
diff --git a/include/config.h.in b/include/config.h.in
index 79f8b45085c..a35e31bd906 100644
--- a/include/config.h.in
+++ b/include/config.h.in
@@ -74,6 +74,9 @@
 /* Define to 1 if you have the <cups/cups.h> header file. */
 #undef HAVE_CUPS_CUPS_H
 
+/* Define to 1 if you have the <cups/ppd.h> header file. */
+#undef HAVE_CUPS_PPD_H
+
 /* Define to 1 if you have the <curses.h> header file. */
 #undef HAVE_CURSES_H
 
-- 
2.51.1

